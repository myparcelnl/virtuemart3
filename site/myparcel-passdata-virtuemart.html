<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>MyParcel - osCommerce - Passdata from PostNL through MyParcel</title>
</head>
<body>
<script type="text/javascript">
/* Querystring.js ******************************************************************************/
    function Querystring(qs) { // optionally pass a querystring to parse
        this.params = new Object()
        this.get=Querystring_get

        if (qs == null)
            qs=location.search.substring(1,location.search.length)

        if (qs.length == 0) return

        qs = qs.replace(/\+/g, ' ')
        var args = qs.split('&') // parse out name/value pairs separated via &


        for (var i=0;i<args.length;i++) {
            var value;
            var pair = args[i].split('=')
            var name = unescape(pair[0])

            if (pair.length == 2)
                value = unescape(pair[1])
            else
                value = name

            this.params[name] = value
        }
    }

    function Querystring_get(key, default_) {
        // This silly looking line changes UNDEFINED to NULL
        if (default_ == null) default_ = null;

        var value=this.params[key]
        if (value==null) value=default_;

        return value
    }

    window.onload = passData;
    function passData()
    {
        var name;
        var street;
        var houseNr;
        var houseNrAdd;
        var postalCodeNum;
        var postalCodeAlpha;
        var city;

        var qs = new Querystring();
        if (qs.get("action") == "confirm")
        {
            name            = qs.get('name');
            street          = qs.get('street');
            houseNr         = qs.get('housenumber');
            houseNrAdd      = qs.get('housenumberadd');
            postalCodeNum   = qs.get('postalcodenum');
            postalCodeAlpha = qs.get('postalcodealpha');
            city            = qs.get('city');

            if(parent.parent.window.opener)
            {
                var shopname = name.split('&nbsp;&nbsp;');
                if(shopname.length == 2) shopname = shopname[1];

                // NOTE: hieronder specificeert u de naam van het formulier
                // in dit voorbeeld: 'checkout_shipping'
                var formulier = parent.parent.window.opener.document.forms['userForm'];

                // NOTE: hieronder stopt u de variabelen in uw formulier
                // in dit voorbeeld: 'company', 'postcode', 'street_address', 'house_number' en 'city'
                formulier['shipto_company_field'].value   = shopname;
                formulier['shipto_zip_field'].value       = postalCodeNum + postalCodeAlpha;
                formulier['shipto_address_1_field'].value = street + ' ' + houseNr + ' ' + houseNrAdd;
                formulier['shipto_city_field'].value      = city;
                // NOTE: de locatie slaan we op als 'bedrijf'. De naam van de persoon die afhaalt, dient door de klant ingevuld te worden in een 'naam' veld.

                // NOTE: zorg dat pakjegemak zendingen naar Nederland gaan
                // in dit voorbeeld vullen we de 'country' drop-down automatisch goed in
                formulier['shipto_virtuemart_country_id'].value = 150;
                parent.parent.window.opener.document.getElementById('shipto_virtuemart_country_id').style.display = 'block';
                if (parent.parent.window.opener.document.getElementById('shipto_virtuemart_country_id_chzn')) { parent.parent.window.opener.document.getElementById('shipto_virtuemart_country_id_chzn').style.display = 'none'; }
            }
        }
        /*------------ Since version 1.0.7 ----------*/
        var pg_data = new Array('pg_extra_name=' + shopname, 'pg_extra_street=' + street, 'pg_extra_house_number=' + houseNr, 'pg_extra_number_addition=' + houseNrAdd, 'pg_extra_postcode=' + postalCodeNum + postalCodeAlpha, 'pg_extra_town=' + city);
        loadXMLDoc(pg_data);
        /*--------------------------------------1.0.7*/
    }
	
	/*------------ Since version 1.0.7 ----------*/
    function loadXMLDoc(pg_data) {
        var xmlhttp;

        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
                parent.parent.window.close();
            }
        }

        var params = pg_data.join('&');

        xmlhttp.open("GET", "/index.php?option=com_myparcel" + "&" + "task=save_pg_address" + "&" + "tmpl=component" + "&" + params, true);
        xmlhttp.send();
    }
    /*----------------------------------------1.0.7*/
</script>
</body>
</html>